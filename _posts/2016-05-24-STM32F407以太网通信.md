---
layout: post
title:  "STM32F407以太网通信"
date:   2016-05-24
---

### 开发板板载资源

```
ALIENTEK正点原子探索者STM32F407开发板


◆ CPU:STM32F407ZGT6,LQFP144,FLASH:1024K,SRAM:192K;
◆ 外扩 SRAM:IS62WV51216,1M 字节
◆ 外扩 SPI FLASH:W25Q128,16M 字节
◆ 1 个电源指示灯(蓝色)
◆ 2 个状态指示灯(DS0:红色,DS1:绿色)
◆ 1 个红外接收头,并配备一款小巧的红外遥控器
◆ 1 个 EEPROM 芯片,24C02,容量 256 字节
◆ 1 个六轴(陀螺仪+加速度)传感器芯片,MPU6050
◆ 1 个高性能音频编解码芯片,WM8978
◆ 1 个 2.4G 无线模块接口,支持 NRF24L01 无线模块
◆ 1 路 CAN 接口,采用 TJA1050 芯片
◆ 1 路 485 接口,采用 SP3485 芯片
◆ 2 路 RS232 串口(一公一母)接口,采用 SP3232 芯片
◆ 1 路单总线接口,支持 DS18B20/DHT11 等单总线传感器
◆ 1 个 ATK 模块接口,支持 ALIENTEK 蓝牙/GPS 模块
◆ 1 个光敏传感器
◆ 1 个标准的 2.4/2.8/3.5/4.3/7 寸 LCD 接口,支持电阻/电容触摸屏
◆ 1 个摄像头模块接口
◆ 1 个 OLED 模块接口
◆ 1 个 USB 串口,可用于程序下载和代码调试(USMART 调试)
◆ 1 个 USB SLAVE 接口,用于 USB 从机通信
◆ 1 个 USB HOST(OTG)接口,用于 USB 主机通信
◆ 1 个有源蜂鸣器
◆ 1 个 RS232/RS485 选择接口
◆ 1 个 RS232/模块选择接口
◆ 1 个 CAN/USB 选择接口
◆ 1 个串口选择接口
◆ 1 个 SD 卡接口(在板子背面)
◆ 1 个百兆以太网接口(RJ45)
◆ 1 个标准的 JTAG/SWD 调试下载口
◆ 1 个录音头(MIC/咪头)
◆ 1 路立体声音频输出接口
◆ 1 路立体声录音输入接口
◆ 1 路扬声器输出接口,可接 1W 左右小喇叭
◆ 1 组多功能端口(DAC/ADC/PWM DAC/AUDIO IN/TPAD)
◆ 1 组 5V 电源供应/接入口
◆ 1 组 3.3V 电源供应/接入口
◆ 1 个参考电压设置接口
◆ 1 个直流电源输入接口(输入电压范围:DC6~16V)
◆ 1 个启动模式选择配置接口
◆ 1 个 RTC 后备电池座,并带电池
◆ 1 个复位按钮,可用于复位 MCU 和 LCD
◆ 4 个功能按钮,其中 KEY_UP(即 WK_UP)兼具唤醒功能
◆ 1 个电容触摸按键
◆ 1 个电源开关,控制整个板的电源
◆ 独创的一键下载功能
◆ 除晶振占用的 IO 口外,其余所有 IO 口全部引出
```

----

![探索者STM32F4](http://explorerlxz.github.io/images/STM32F4.png)

现阶段网络通信方面的程序用linux上C语言熟练一点，重点是可以参考的例程比较多，用windows开发一点信心也没有了。计算机不能通过网络直接执行单片机上面的命令，但可以自己编程定义命令，让单片机收到网络信息执行定义的动作。

现阶段只是进行最为简单的通信。单片机上共有四个按键KEY0，KEY1，KEY2，KEY_UP。两个可以控制的led灯，一黄一红。

现在单片机中下载的程序使用TCP通信，可以实现按键后发送代表键值的字符1[KEY0]，2[KEY1]，3[KEY2]到与之连接的客户端（远程计算机）上，远程计算机发送自己编程定义的命令使单片机控制led的开关。按KEY0后红灯取反，按KEY1后黄灯取反，按KEY2后两个灯取反。


现在客户端上的程序接收到代表键值字符，向服务器（单片机）发送自己定义的用于控制led的字符，并且计算出led的状态，打印出来。

现在一边用windows xp的keil 5往stm32f407开发板上烧写单片机的程序，一边用ubuntu写计算机程序，进行测试，出了问题时不时的用wireshark抓个包，调试一下程序。

----

2016-05-26更新

### 老板提出的新需求：

```
1、电脑每秒读取100次单片机按键的状态（10ms一次）；
2、电脑可以控制led灯的状态；
3、可能会有同时连接10个单片机的需求。
```

单片机与电脑通过TCP/IP协议通信，计算机是服务器端。
服务器端在固定的IP地址和端口监听，客户端连接网络后自动连接服务器，有客户端连接时服务器创建新的线程与之通信（是否需要分配新的端口？）。

![tcp-chatroom](http://explorerlxz.github.io/images/tcp-chatroom.png)


----

## Reference

Quora: [How do I start learning STM32? Is it worth it?](https://www.quora.com/How-do-I-start-learning-STM32-Is-it-worth-it)
